<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Orion Commercial Architect v5</title>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Utilities -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Yoco SDK -->
    <script src="https://js.yoco.com/sdk/v1/yoco-sdk-web.js"></script>
    
    <!-- Fonts: Quicksand -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Quicksand', 'sans-serif'],
                    },
                    colors: {
                        sa: {
                            midnight: '#0B1221', /* The Deep Navy from your Screenshot */
                            blue: '#001d7a',     /* Royal Navy */
                            red: '#c4261d',      /* Deep Crimson */
                            gold: '#eab308',     /* Rich Gold */
                            green: '#007a4d',    /* Flag Green */
                            slate: '#f8fafc'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background: #0B1221; color: #f8fafc; -webkit-font-smoothing: antialiased; }
        
        /* Premium Paper Effect */
        .paper-sheet {
            background: white;
            color: #0f172a;
            width: 100%;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        @media (min-width: 768px) {
            .paper-sheet {
                max-width: 210mm;
                min-height: 297mm;
            }
        }

        /* Classy Form Elements */
        .input-field {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            width: 100%;
            outline: none;
            transition: all 0.3s ease;
            background: #f8fafc;
            color: #334155;
            font-weight: 600;
        }
        .input-field:focus {
            border-color: #001d7a;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(0, 29, 122, 0.1);
        }
        .input-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* Signature Pad */
        canvas.sig-pad {
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
            border-radius: 8px;
            cursor: crosshair;
            touch-action: none;
            width: 100%;
        }

        .yoco-iframe-container { z-index: 9999 !important; }

        /* Legal Text */
        .legal-text { font-size: 9px; line-height: 1.4; color: #64748b; text-align: justify; }
        .legal-h3 { font-size: 12px; font-weight: bold; color: #001d7a; margin-top: 10px; margin-bottom: 4px; text-transform: uppercase; }

        /* Print Optimization */
        @media print {
            body { background: white; margin: 0; padding: 0; }
            .paper-sheet { box-shadow: none; margin: 0; width: 100%; max-width: none; padding: 0; border: none; }
            .no-print { display: none !important; }
            .print-grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 2rem; }
            .print-col-7 { grid-column: span 7 / span 12; }
            .print-col-5 { grid-column: span 5 / span 12; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body class="py-8 min-h-screen flex items-center justify-center">

    <div id="root" class="w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURATION ---
        const YOCO_PUBLIC_KEY = 'pk_test_ed360be6q5e3784865d5'; 

        const App = () => {
            // --- STATE ---
            const [client, setClient] = useState({ name: '', manager: '', email: '', vat: '' });
            const [property, setProperty] = useState({ rooms: 20, stars: 3 });

            const [modules, setModules] = useState({
                core: true, 
                missionControl: false,
                linguist: false,
                managerTools: false,
                payments: false
            });

            const [revenueCenters, setRevenueCenters] = useState({
                restaurant: { count: 0, price: 3500, label: "Restaurant" },
                bar: { count: 0, price: 2500, label: "Bar / Lounge" },
                coffee: { count: 0, price: 2000, label: "Coffee Shop" },
                spa: { count: 0, price: 3000, label: "Spa & Wellness" },
                conference: { count: 0, price: 4500, label: "Conference Hall" }
            });

            const [totals, setTotals] = useState({ monthly: 0, setup: 0 });
            const [isPaying, setIsPaying] = useState(false);
            
            // Signature
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [hasSignature, setHasSignature] = useState(false);
            const [paidStatus, setPaidStatus] = useState(false);

            // --- PRICING LOGIC ---
            const COSTS = {
                core: { monthly: 999, setup: 4999 },
                missionControl: { monthly: 750, setup: 3500 },
                linguist: { monthly: 500, setup: 2500 },
                managerTools: { monthly: 1250, setup: 5000 },
                payments: { monthly: 250, setup: 1500 }
            };

            useEffect(() => {
                let monthly = COSTS.core.monthly;
                let setup = COSTS.core.setup;

                if (modules.missionControl) { monthly += COSTS.missionControl.monthly; setup += COSTS.missionControl.setup; }
                if (modules.linguist) { monthly += COSTS.linguist.monthly; setup += COSTS.linguist.setup; }
                if (modules.managerTools) { monthly += COSTS.managerTools.monthly; setup += COSTS.managerTools.setup; }
                if (modules.payments) { monthly += COSTS.payments.monthly; setup += COSTS.payments.setup; }

                Object.values(revenueCenters).forEach(center => {
                    monthly += (center.count * center.price);
                    if (center.count > 0) setup += (center.count * 1500); 
                });

                if (property.rooms > 20) {
                    monthly += ((property.rooms - 20) * 45);
                }

                let multiplier = 1;
                if (property.stars === 4) multiplier = 1.15;
                if (property.stars === 5) multiplier = 1.35;

                monthly = Math.round(monthly * multiplier);

                setTotals({ monthly, setup });

            }, [modules, revenueCenters, property]);

            // --- HANDLERS ---
            const toggleModule = (key) => {
                if (key === 'core') return;
                setModules(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const updateCenter = (key, delta) => {
                setRevenueCenters(prev => {
                    const newCount = Math.max(0, prev[key].count + delta);
                    return { ...prev, [key]: { ...prev[key], count: newCount } };
                });
            };

            const formatCurrency = (val) => new Intl.NumberFormat('en-ZA', { style: 'currency', currency: 'ZAR', maximumFractionDigits: 0 }).format(val);

            // --- YOCO PAYMENT ---
            const handlePayDeposit = () => {
                if (!window.YocoSDK) return alert("Yoco SDK not loaded");
                if (!client.email) return alert("Please enter client email first");

                setIsPaying(true);
                const yoco = new window.YocoSDK({ publicKey: YOCO_PUBLIC_KEY });
                
                yoco.showPopup({
                    amountInCents: (totals.setup * 100),
                    currency: 'ZAR',
                    name: 'Orion Hotel Suite',
                    description: 'Activation Setup Fee',
                    callback: function (result) {
                        setIsPaying(false);
                        if (result.error) {
                            alert("Payment Failed: " + result.error.message);
                        } else {
                            alert("Payment Successful! Token: " + result.id);
                            setPaidStatus(true);
                        }
                    }
                });
            };

            // --- DRAWING ---
            const getCoords = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: clientX - rect.left, y: clientY - rect.top };
            };

            const startDrawing = (e) => {
                setIsDrawing(true);
                const ctx = canvasRef.current.getContext('2d');
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#001d7a';
                const { x, y } = getCoords(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const { x, y } = getCoords(e);
                const ctx = canvasRef.current.getContext('2d');
                ctx.lineTo(x, y);
                ctx.stroke();
                setHasSignature(true);
            };

            const stopDrawing = () => setIsDrawing(false);
            const clearSignature = () => {
                const ctx = canvasRef.current.getContext('2d');
                ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                setHasSignature(false);
            };

            const generatePDF = () => {
                if (!client.name) return alert("Please enter the Client Name.");
                if (!hasSignature) return alert("Please sign the document before generating the contract.");
                
                window.scrollTo(0, 0); 
                
                const element = document.getElementById('proposal-content');
                const opt = {
                    margin: 0,
                    filename: `Orion_Contract_${client.name.replace(/\s+/g, '_')}_2026.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                document.body.classList.add('printing');
                document.querySelectorAll('.no-print').forEach(el => el.style.display = 'none');
                
                html2pdf().set(opt).from(element).save().then(() => {
                    document.querySelectorAll('.no-print').forEach(el => el.style.display = 'block');
                    document.body.classList.remove('printing');
                });
            };

            return (
                <div className="flex justify-center w-full px-4">
                    <div id="proposal-content" className="paper-sheet p-8 md:p-16 flex flex-col text-slate-800">
                        
                        {/* PAGE 1: COMMERCIAL PROPOSAL */}
                        <div className="min-h-[1050px] relative flex flex-col">
                            {/* HEADER */}
                            <div className="flex flex-col md:flex-row justify-between items-start border-b-2 border-slate-100 pb-8 mb-10 gap-6">
                                <div>
                                    <h1 className="text-4xl font-bold tracking-tight text-sa-midnight">Orion<span className="font-light text-sa-blue">Suite</span></h1>
                                    <div className="flex items-center gap-2 mt-2">
                                        <div className="h-1 w-8 bg-sa-gold rounded-full"></div>
                                        <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">Enterprise Solution Agreement</p>
                                    </div>
                                </div>
                                <div className="text-left md:text-right">
                                    <div className="text-xs font-semibold text-sa-gold mt-1 uppercase tracking-wide">South African Edition</div>
                                    <div className="text-xs text-slate-400 mt-2 font-mono">Ref: {new Date().getFullYear()}-ZA-001</div>
                                </div>
                            </div>

                            {/* CLIENT GRID */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-10 mb-12 print-grid-2">
                                <div className="bg-slate-50 p-6 rounded-xl border border-slate-100">
                                    <h3 className="text-xs font-bold text-sa-blue uppercase mb-4 tracking-widest flex items-center gap-2">
                                        <i className="ph-bold ph-user"></i> Client Details
                                    </h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="input-label">Business Name (Registered)</label>
                                            <input type="text" placeholder="e.g. The Oyster Box Pty Ltd" className="input-field font-bold text-slate-900"
                                                value={client.name} onChange={e => setClient({...client, name: e.target.value})} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="input-label">Manager Name</label>
                                                <input type="text" placeholder="John Doe" className="input-field"
                                                    value={client.manager} onChange={e => setClient({...client, manager: e.target.value})} />
                                            </div>
                                            <div>
                                                <label className="input-label">VAT No (Optional)</label>
                                                <input type="text" placeholder="4000..." className="input-field"
                                                    value={client.vat} onChange={e => setClient({...client, vat: e.target.value})} />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="input-label">Email for Billing</label>
                                            <input type="email" placeholder="accounts@hotel..." className="input-field"
                                                value={client.email} onChange={e => setClient({...client, email: e.target.value})} />
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-xl border border-slate-100">
                                    <h3 className="text-xs font-bold text-sa-blue uppercase mb-4 tracking-widest flex items-center gap-2">
                                        <i className="ph-bold ph-buildings"></i> Configuration
                                    </h3>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div>
                                            <label className="input-label">Room Count</label>
                                            <input type="number" value={property.rooms} onChange={e => setProperty({...property, rooms: parseInt(e.target.value) || 0})}
                                                className="input-field text-right font-mono text-lg" />
                                        </div>
                                        <div>
                                            <label className="input-label">Star Rating</label>
                                            <select value={property.stars} onChange={e => setProperty({...property, stars: parseInt(e.target.value)})}
                                                className="input-field text-right cursor-pointer bg-white">
                                                <option value={3}>3 Star</option>
                                                <option value={4}>4 Star</option>
                                                <option value={5}>5 Star</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6 pt-4 border-t border-slate-200">
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs text-slate-500 font-bold uppercase">Pricing Tier</span>
                                            <span className="bg-sa-midnight text-white px-3 py-1 rounded text-xs font-bold">
                                                {property.stars === 5 ? 'Premier' : property.stars === 4 ? 'Business' : 'Standard'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* MODULES LIST */}
                            <div className="mb-8">
                                <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 border-b border-slate-200 pb-2">Selected Architecture</h3>
                                <div className="space-y-2">
                                    <div className="flex justify-between items-center p-3 bg-blue-50 border border-blue-100 rounded">
                                        <span className="text-sm font-bold text-sa-midnight">Core AI Platform</span>
                                        <span className="text-sm font-mono font-bold">R 999.00</span>
                                    </div>
                                    {modules.missionControl && (
                                        <div className="flex justify-between items-center p-3 border border-slate-100 rounded">
                                            <span className="text-sm text-slate-600">Mission Control (Dashboard + Dept Routing)</span>
                                            <span className="text-sm font-mono">R 750.00</span>
                                        </div>
                                    )}
                                    {modules.linguist && (
                                        <div className="flex justify-between items-center p-3 border border-slate-100 rounded">
                                            <span className="text-sm text-slate-600">Global Linguist (20 Langs + Zulu TTS)</span>
                                            <span className="text-sm font-mono">R 500.00</span>
                                        </div>
                                    )}
                                    {modules.managerTools && (
                                        <div className="flex justify-between items-center p-3 border border-slate-100 rounded">
                                            <span className="text-sm text-slate-600">AI Manager Tools (Planner + Reviews)</span>
                                            <span className="text-sm font-mono">R 1,250.00</span>
                                        </div>
                                    )}
                                    {modules.payments && (
                                        <div className="flex justify-between items-center p-3 border border-slate-100 rounded">
                                            <span className="text-sm text-slate-600">Payment Gateway (Yoco/SnapScan)</span>
                                            <span className="text-sm font-mono">R 250.00</span>
                                        </div>
                                    )}
                                    {Object.values(revenueCenters).filter(r => r.count > 0).map((center, i) => (
                                        <div key={i} className="flex justify-between items-center p-3 border border-slate-100 rounded bg-yellow-50/50">
                                            <span className="text-sm text-slate-600">{center.label} x{center.count}</span>
                                            <span className="text-sm font-mono">R {formatCurrency(center.count * center.price).replace('R', '')}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* TOTALS */}
                            <div className="flex flex-col lg:flex-row justify-end mb-12 gap-8 mt-auto">
                                <div className="lg:w-1/3 text-right">
                                    <div className="text-xs font-bold text-slate-400 uppercase mb-1">Monthly Subscription</div>
                                    <div className="text-2xl font-bold text-slate-700">{formatCurrency(totals.monthly)}</div>
                                    <div className="text-[10px] text-slate-400 italic">Valid for 30 days. Starts on Go-Live.</div>
                                </div>
                                <div className="lg:w-1/3 bg-sa-midnight text-white p-6 rounded-xl shadow-xl relative overflow-hidden">
                                    <div className="relative z-10">
                                        <div className="flex justify-between items-start mb-6">
                                            <div>
                                                <div className="text-xs font-bold text-blue-200 uppercase tracking-widest mb-1">Activation Fee</div>
                                                <div className="text-xs text-blue-300">Due Upon Acceptance</div>
                                            </div>
                                            {paidStatus && <div className="bg-sa-green text-white text-[10px] font-bold px-2 py-1 rounded">PAID</div>}
                                        </div>
                                        <div className="text-right border-t border-white/20 pt-4">
                                            <div className="text-3xl font-bold tracking-tight">{formatCurrency(totals.setup)}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* SIGNATURE */}
                            <div className="border-t border-slate-200 pt-6">
                                <h4 className="text-xs font-bold text-slate-400 uppercase mb-3">Acceptance & Execution</h4>
                                <div className="flex gap-8">
                                    <div className="w-1/2">
                                        <div className="h-24 border border-dashed border-slate-300 rounded bg-slate-50 relative">
                                            {hasSignature ? (
                                                <img src={canvasRef.current.toDataURL()} className="h-full w-full object-contain" />
                                            ) : (
                                                <div className="absolute inset-0 flex items-center justify-center text-xs text-slate-400">Digital Signature</div>
                                            )}
                                        </div>
                                        <div className="mt-2 text-xs font-bold">{client.name || 'Client'}</div>
                                    </div>
                                    <div className="w-1/2">
                                        <div className="h-24 flex items-end pb-4 border-b border-slate-300">
                                            <div className="font-script text-2xl text-sa-blue">Graham Schubach</div>
                                        </div>
                                        <div className="mt-2 text-xs font-bold">Orion Dev Core</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* PAGE 2: LEGAL SCHEDULES (Hidden until print) */}
                        <div className="page-break mt-12 pt-12 border-t-4 border-sa-blue">
                            <h2 className="text-2xl font-bold text-sa-midnight mb-8">Schedule A: Service Level Agreement (SLA)</h2>
                            
                            <div className="grid grid-cols-2 gap-8 mb-8">
                                <div>
                                    <h3 className="legal-h3">1. Service Availability</h3>
                                    <p className="legal-text">Orion Dev Core guarantees 99.9% uptime for the Core AI Platform. Maintenance windows will be communicated 48 hours in advance via the Mission Control Dashboard. In the event of downtime exceeding 1 hour during peak operational hours (06:00 - 22:00), the Client is eligible for a pro-rata credit.</p>
                                    
                                    <h3 className="legal-h3">2. Response Times</h3>
                                    <p className="legal-text">Critical Bugs (System Down): 2 Hours.<br/>Major Bugs (Feature Broken): 12 Hours.<br/>Minor Requests: 48 Hours.<br/>Support is available Mon-Sun, 08:00 - 17:00 SAST.</p>
                                </div>
                                <div>
                                    <h3 className="legal-h3">3. Data Integrity</h3>
                                    <p className="legal-text">Database backups are performed every 6 hours. Backups are retained for 30 days. In the event of data corruption, restoration will be attempted to the nearest 6-hour checkpoint.</p>
                                </div>
                            </div>

                            <h2 className="text-2xl font-bold text-sa-midnight mb-6 mt-12">Schedule B: POPI Act Compliance (Data Processing)</h2>
                            <div className="bg-slate-50 p-6 rounded-xl border border-slate-100">
                                <h3 className="legal-h3">1. Role of Parties</h3>
                                <p className="legal-text">The Client (Hotel) is the "Responsible Party" and Orion Dev Core is the "Operator" as defined in the Protection of Personal Information Act (POPIA).</p>

                                <h3 className="legal-h3">2. Processing Limitations</h3>
                                <p className="legal-text">Orion Dev Core shall process Personal Information only with the knowledge or authorisation of the Client. Guest chats are ephemeral and are automatically deleted from the live database 48 hours after guest checkout.</p>
                                
                                <h3 className="legal-h3">3. Security Measures</h3>
                                <p className="legal-text">We employ Google Cloud Platform's enterprise-grade security, including encryption in transit (SSL/TLS) and at rest (AES-256). Access to data is restricted to authorised personnel via 2FA.</p>
                            </div>
                        </div>

                        {/* CONTROLS (Floating) */}
                        <div className="fixed bottom-8 right-8 no-print z-50 flex flex-col gap-4 items-end">
                             {/* SIGNATURE PAD OVERLAY (Only visible if needed) */}
                             {!hasSignature && (
                                <div className="bg-white p-4 rounded-xl shadow-2xl border border-slate-200 mb-4 w-80">
                                    <div className="text-xs font-bold mb-2 text-slate-500 uppercase">Sign Here</div>
                                    <canvas 
                                        ref={canvasRef}
                                        width={280}
                                        height={100}
                                        className="sig-pad border border-slate-300 rounded"
                                        onMouseDown={startDrawing}
                                        onMouseMove={draw}
                                        onMouseUp={stopDrawing}
                                        onMouseLeave={stopDrawing}
                                        onTouchStart={startDrawing}
                                        onTouchMove={draw}
                                        onTouchEnd={stopDrawing}
                                    />
                                    <div className="flex justify-between mt-2">
                                        <button onClick={clearSignature} className="text-xs text-red-500">Clear</button>
                                        <button onClick={() => setHasSignature(true)} className="text-xs text-green-600 font-bold">Accept Signature</button>
                                    </div>
                                </div>
                             )}

                            <button 
                                onClick={handlePayDeposit}
                                disabled={isPaying || paidStatus}
                                className={`font-bold py-3 px-6 rounded-full shadow-lg flex items-center justify-center gap-3 transition-all active:scale-95 border ${paidStatus ? 'bg-sa-green border-sa-green text-white cursor-default' : 'bg-sa-blue hover:bg-blue-900 text-white border-white/10'}`}
                            >
                                {isPaying ? (
                                    <i className="ph ph-spinner animate-spin text-xl"></i>
                                ) : paidStatus ? (
                                    <i className="ph-bold ph-check text-xl"></i>
                                ) : (
                                    <i className="ph-bold ph-credit-card text-xl"></i>
                                )}
                                <span>{paidStatus ? 'Deposit Paid' : `Pay Setup (${formatCurrency(totals.setup)})`}</span>
                            </button>

                            <button 
                                onClick={generatePDF}
                                className="bg-sa-midnight hover:bg-black text-white font-bold py-4 px-6 rounded-full shadow-2xl flex items-center gap-3 transition-transform active:scale-95 border border-slate-700"
                            >
                                <i className="ph-bold ph-file-pdf text-xl"></i>
                                <span>Generate Contracts</span>
                            </button>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
